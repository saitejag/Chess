<html>
    <style>
        .col{
            background-color: gray;
        }
    </style>    
    <script>
        setcol = "brown";
        pw = 0.9;
        ng = 1;
        prevx = -1;
        prevy = -1;
        turn = 0;//white
        var hl = new Array(8);
        for(var i = 0;i < 8;i++){
            hl[i] = new Array(8);
        }
        for(var i = 0;i < 8;i++){
            for(var j = 0;j < 8;j++){
                hl[i][j] = '0';
            }
        }
        var matpos = new Array(8);
        for(var i = 0;i < 8;i++){
            matpos[i] = new Array(8);
        }
        for(var i = 0;i < 8;i++){
            matpos[i][1] = "wpawn";
            matpos[i][6] = "bpawn";
        }
        matpos[0][0] = "wrook";
        matpos[7][0] = "wrook";
        matpos[0][7] = "brook";
        matpos[7][7] = "brook";
        inipos = 
        {
            "white": {
                "rook1": {
                    r: 0,
                    c: 0,
                    active: 1
                },
                "rook2": {
                    r: 7,
                    c: 0,
                    active: 1
                },
                "pawn1": {
                    r: 0,
                    c: 1,
                    active: 1
                },
                "pawn2": {
                    r: 1,
                    c: 1,
                    active: 1
                },
                "pawn3": {
                    r: 2,
                    c: 1,
                    active: 1
                },
                "pawn4": {
                    r: 3,
                    c: 1,
                    active: 1
                },
                "pawn5": {
                    r: 4,
                    c: 1,
                    active: 1
                },
                "pawn6": {
                    r: 5,
                    c: 1,
                    active: 1
                },
                "pawn7": {
                    r: 6,
                    c: 1,
                    active: 1
                },
                "pawn8": {
                    r: 7,
                    c: 1,
                    active: 1
                }  
            },
            "black": {
                "rook1": {
                    r: 0,
                    c: 7,
                    active: 1
                },
                "rook2": {
                    r: 7,
                    c: 7,
                    active: 1
                },
                "pawn1": {
                    r: 0,
                    c: 6,
                    active: 1
                },
                "pawn2": {
                    r: 1,
                    c: 6,
                    active: 1
                },
                "pawn3": {
                    r: 2,
                    c: 6,
                    active: 1
                },
                "pawn4": {
                    r: 3,
                    c: 6,
                    active: 1
                },
                "pawn5": {
                    r: 4,
                    c: 6,
                    active: 1
                },
                "pawn6": {
                    r: 5,
                    c: 6,
                    active: 1
                },
                "pawn7": {
                    r: 6,
                    c: 6,
                    active: 1
                },
                "pawn8": {
                    r: 7,
                    c: 6,
                    active: 1
                }                
            }
        }
        pos = inipos;
        function start(){
            c = document.getElementById("can");
            ctx = c.getContext("2d");
            if(window.innerHeight<window.innerWidth){
                c.height = pw*window.innerHeight;    
                c.width = pw*window.innerHeight;
            }
            else{    
                c.width = pw*window.innerWidth;
                c.height = pw*window.innerWidth;
            }
            bx = c.width/8;
            by = c.height/8;
            game();
//            setInterval(game(),1000/15);
        }
        function drawpiece(x,y,s){
            if((x+y)%2 == 0){
                ctx.fillStyle = "white";
            }
            else{
                ctx.fillStyle = setcol;
            }
            ctx.fillRect(x*bx,y*by,bx,by);
            if(s == "bpawn"){
                bp4 = new Image();
                bp4.src = 'images/bpawn.png';
                bp4.onload = function(){
                    ctx.drawImage(bp4,bx*x,by*y,bx,by);
                }
            }
            if(s == "wpawn"){
                wp4 = new Image();
                wp4.src = 'images/wpawn.png';
                wp4.onload = function(){
                    ctx.drawImage(wp4,bx*x,by*y,bx,by);
                }
            } 
            if(s == "wrook"){
                wr4 = new Image();
                wr4.src = 'images/wrook.png';
                wr4.onload = function(){
                    ctx.drawImage(wr4,bx*x,by*y,bx,by);
                } 
            }
            if(s == "brook"){
                br4 = new Image();
                br4.src = 'images/brook.png';
                br4.onload = function(){
                    ctx.drawImage(br4,bx*x,by*y,bx,by);
                } 
            }
        }
        function borderfill(x,y){
            ctx.fillStyle = "blue";
            ctx.fillRect(Math.floor(x/bx)*bx,Math.floor(y/by)*by,bx,0.05*by);               ctx.fillRect(Math.floor(x/bx)*bx,Math.floor(y/by)*by,0.05*bx,by);
            ctx.fillRect(Math.floor(x/bx)*bx,Math.floor(y/by)*by+by-(0.05*by),bx,0.05*by);             
            ctx.fillRect(Math.floor(x/bx)*bx+bx-(0.05*bx),Math.floor(y/by)*by,0.05*bx,by);
            hl[Math.floor(x/bx)][Math.floor(y/by)] = 1;
            
        }
        function borderclear(){
            for(var i = 0;i < 8;i++){
                for(var j = 0;j < 8;j++){
                    if(hl[i][j]==1){
                        if((i+j)%2==0){
                            ctx.fillStyle = "white";
                        }
                        else{
                            ctx.fillStyle = setcol;
                        }
                        ctx.fillRect(i*bx,j*by,bx,0.05*by);                         
                        ctx.fillRect(i*bx,j*by,0.05*bx,by);
                        ctx.fillRect(i*bx,j*by+by-(0.05*by),bx,0.05*by);             
                        ctx.fillRect(i*bx+bx-(0.05*bx),j*by,0.05*bx,by);

                        hl[i][j] = 0;                        
                    }
                }
            }
        }
        function possibilities(x,y){
            if(matpos[x][y]=="wpawn"){
                console.log(1);
                if(x+1 < 8 && y+1 < 8 && matpos[x+1][y+1]!=null){
                    if(matpos[x+1][y+1][0]=='b'){
                        borderfill((x+1)*c.width/8,(y+1)*c.height/8);
                        hl[x+1][y+1] = 1;
                    }
                }
                if(x-1 >= 0 && y+1 < 8 && matpos[x-1][y+1]!=null){
                    if(matpos[x-1][y+1][0]=='b'){    
                        borderfill((x-1)*c.width/8,(y+1)*c.height/8);
                        hl[x-1][y+1] = 1;
                    }
                }
                if(y+1<8 && matpos[x][y+1]==null){
                    if(y==1 && matpos[x][3]==null){
                        borderfill(x*bx,(3)*bx);
                        hl[x][y+2] = 1;
                    }
                    borderfill(x*bx,(y+1)*by);
                    hl[x][y+1] = 1;
                }
            }
            if(matpos[x][y]=="bpawn"){
                console.log(2);
                if(x+1 < 8 && y-1 >= 0 && matpos[x+1][y-1]!=null){
                    if(matpos[x+1][y-1][0]=='w'){
                        borderfill((x+1)*c.width/8,(y-1)*c.height/8);
                        hl[x+1][y-1] = 1;
                    }
                }
                if(x-1 >= 0 && y-1 >= 0 && matpos[x-1][y-1]!=null){
                    if(matpos[x-1][y-1][0]=='w'){
                        borderfill((x-1)*c.width/8,(y-1)*c.height/8);
                        hl[x-1][y-1] = 1;
                    }
                }
                if(y-1>=0 && matpos[x][y-1]==null){
                    if(y==6 && matpos[x][4]==null){
                        borderfill(x*bx,4*bx);
                        hl[x][4] = 1;
                    }
                    borderfill(x*bx,(y-1)*by);
                    hl[x][y-1] = 1;
                }
            }
            if(matpos[x][y]=="wrook" || matpos[x][y]=="brook"){
                l = 1;
                while(x+l < 8 && matpos[x+l][y]==null){
                    borderfill((x+l)*bx,y*by);
                    hl[x+l][y] = 1;
                    l++;
                }
                if(x+l < 8){
                    if(matpos[x+l][y][0]!=matpos[x][y][0]){
                        borderfill((x+l)*bx,y*by);
                        hl[x+l][y] = 1;   
                    }
                }
                l = 1;
                while(y+l < 8 && matpos[x][y+l]==null){
                    borderfill(x*bx,(y+l)*by);
                    hl[x][y+l] = 1;
                    l++;
                }
                if(y+l < 8){
                    if(matpos[x][y+l][0]!=matpos[x][y][0]){
                        borderfill((x)*bx,(y+l)*by);
                        hl[x][y+l] = 1;   
                    }
                }
                l = 1;
                while(x-l >= 0 && matpos[x-l][y]==null){
                    borderfill((x-l)*bx,y*by);
                    hl[x-1][y] = 1;
                    l++;
                }
                if(x-l >= 0){
                    if(matpos[x-l][y][0]!=matpos[x][y][0]){
                        borderfill((x-l)*bx,y*by);
                        hl[x-l][y] = 1;   
                    }
                }
                l = 1;
                while(y-l>=0 && matpos[x][y-l]==null){
                    borderfill(x*bx,(y-l)*by);
                    hl[x][y-l] = 1;
                    l++;
                }
                if(y-l >= 0){
                    if(matpos[x][y-l][0]!=matpos[x][y][0]){
                        borderfill((x)*bx,(y-l)*by);
                        hl[x][y-l] = 1;   
                    }
                }
            }
        }
        function move(x,y,prevx,prevy){
            if(matpos[prevx][prevy][1] == 'p'){
                if(matpos[prevx][prevy][0] == 'w'){
                    if((prevx+prevy)%2==0){
                        ctx.fillStyle = "white";
                    }
                    if((prevx+prevy)%2!=0){
                        ctx.fillStyle = setcol;
                    }
                    ctx.fillRect(prevx*bx,prevy*by,bx,by);
                    drawpiece(x,y,"wpawn");
                    matpos[x][y] = "wpawn";
                    turn = 1;
                }
                if(matpos[prevx][prevy][0] == 'b'){
                    if((prevx+prevy)%2==0){
                        ctx.fillStyle = "white";
                    }
                    if((prevx+prevy)%2!=0){
                        ctx.fillStyle = setcol;
                    }
                    ctx.fillRect(prevx*bx,prevy*by,bx,by);
                    drawpiece(x,y,"bpawn");
                    matpos[x][y] = "bpawn";
                    turn = 0;
                }
            }
            if(matpos[prevx][prevy][1] == 'r'){
                if(matpos[prevx][prevy][0] == 'w'){
                    if((prevx+prevy)%2==0){
                        ctx.fillStyle = "white";
                    }
                    if((prevx+prevy)%2!=0){
                        ctx.fillStyle = setcol;
                    }
                    ctx.fillRect(prevx*bx,prevy*by,bx,by);
                    drawpiece(x,y,"wrook");
                    matpos[x][y] = "wrook";
                    turn = 1;
                }
                if(matpos[prevx][prevy][0] == 'b'){
                    if((prevx+prevy)%2==0){
                        ctx.fillStyle = "white";
                    }
                    if((prevx+prevy)%2!=0){
                        ctx.fillStyle = setcol;
                    }
                    ctx.fillRect(prevx*bx,prevy*by,bx,by);
                    drawpiece(x,y,"brook");
                    matpos[x][y] = "brook";
                    turn = 0;
                }
            }
            matpos[prevx][prevy] = null;
            borderclear();
        }
        function piececlick(event){
            flag = 0;
            x = event.clientX - c.offsetLeft;
            y = event.clientY - c.offsetTop;
//            console.log(x+" "+y);
            if(hl[Math.floor(x/bx)][Math.floor(y/by)] == 0 || Math.floor(prevx/bx)==Math.floor(x/bx) && Math.floor(prevy/by)==Math.floor(y/by)){   
                borderclear();
            }
            else{
                move(Math.floor(x/bx),Math.floor(y/by),Math.floor(prevx/bx),Math.floor(prevy/by));
                flag = 1;
            }
            if(hl[Math.floor(x/bx)][Math.floor(y/by)] == 0 && matpos[Math.floor(x/bx)][Math.floor(y/by)] != null && flag == 0){
                if(turn == 0){
                    console.log(Math.floor(x/bx)+" "+Math.floor(y/by)+" "+matpos[Math.floor(x/bx)][Math.floor(y/by)])
                    if(matpos[Math.floor(x/bx)][Math.floor(y/by)][0]=='w'){
                        borderfill(x,y);
//                        hl[x][y] = 1;
                        possibilities(Math.floor(x/bx),Math.floor(y/by));    
                    }
                }
                if(turn == 1){
                    if(matpos[Math.floor(x/bx)][Math.floor(y/by)][0]=='b'){
                        borderfill(x,y);
//                        hl[x][y] = 1;
                        possibilities(Math.floor(x/bx),Math.floor(y/by));
                    }
                }
            }
            else{
                borderclear();
            }
            prevx = x;
            prevy = y;
        }
        function game(){
            drawboard();
            if(ng == 1){
                defaultpieces();
                ng = 0;
            }
            drawpieces();
            c.addEventListener('click',piececlick,false);
        }
        function drawboard(){
            ctx.fillStyle = setcol;
            ctx.fillRect(0,0,c.width,c.height);
            x = (c.width)/8;
            y = (c.height)/8;
            ctx.fillStyle = "white";
            for(var i = 0;i < 8;i++){
                for(var j = 0;j < 8;j++){
                    if((i+j)%2==0){
                        ctx.fillRect(i*x,j*y,x,y);
                    }
                }
            }            
        }
        function defaultpieces(){
            pos = inipos;
        }
        function drawpieces(){
//            console.log("draw");
            x = c.width/8;
            y = c.height/8;
            if(pos.black.pawn1.active == 1){
//                bp1 = new Image();
//                bp1.src = 'images/pawn.png';
//                bp1x = pos.black.pawn1.r;
//                bp1y = pos.black.pawn1.c;
//                bp1.onload = function(){
//                    ctx.drawImage(bp1,bp1x*x,bp1y*y,x,y);
//                }
                drawpiece(pos.black.pawn1.r,pos.black.pawn1.c,"bpawn");
            }
            if(pos.black.pawn2.active == 1){
                drawpiece(pos.black.pawn2.r,pos.black.pawn2.c,"bpawn");
            }
            if(pos.black.pawn3.active == 1){
                drawpiece(pos.black.pawn3.r,pos.black.pawn3.c,"bpawn");
            }
            if(pos.black.pawn4.active == 1){
                drawpiece(pos.black.pawn4.r,pos.black.pawn4.c,"bpawn");
            }
            if(pos.black.pawn5.active == 1){
                drawpiece(pos.black.pawn5.r,pos.black.pawn5.c,"bpawn");
            }
            if(pos.black.pawn6.active == 1){
                drawpiece(pos.black.pawn6.r,pos.black.pawn6.c,"bpawn");
            }
            if(pos.black.pawn7.active == 1){
                drawpiece(pos.black.pawn7.r,pos.black.pawn7.c,"bpawn");
            }
            if(pos.black.pawn8.active == 1){
                drawpiece(pos.black.pawn8.r,pos.black.pawn8.c,"bpawn");
            }
            if(pos.black.rook1.active == 1){
                drawpiece(pos.black.rook1.r,pos.black.rook1.c,"brook");
            }
            if(pos.black.rook2.active == 1){
                drawpiece(pos.black.rook2.r,pos.black.rook2.c,"brook");
            }
            
            
            if(pos.white.pawn1.active == 1){
                drawpiece(pos.white.pawn1.r,pos.white.pawn1.c,"wpawn");
            }
            if(pos.white.pawn2.active == 1){
                drawpiece(pos.white.pawn2.r,pos.white.pawn2.c,"wpawn");
            }
            if(pos.white.pawn3.active == 1){
                drawpiece(pos.white.pawn3.r,pos.white.pawn3.c,"wpawn");
            }
            if(pos.white.pawn4.active == 1){
                drawpiece(pos.white.pawn4.r,pos.white.pawn4.c,"wpawn");

            }
            if(pos.white.pawn5.active == 1){
                drawpiece(pos.white.pawn5.r,pos.white.pawn5.c,"wpawn");
            }
            if(pos.white.pawn6.active == 1){
                drawpiece(pos.white.pawn6.r,pos.white.pawn6.c,"wpawn");
            }
            if(pos.white.pawn7.active == 1){
                drawpiece(pos.white.pawn7.r,pos.white.pawn7.c,"wpawn");
            }
            if(pos.white.pawn8.active == 1){
                drawpiece(pos.white.pawn8.r,pos.white.pawn8.c,"wpawn");
            }
            if(pos.white.rook1.active == 1){
                drawpiece(pos.white.rook1.r,pos.white.rook1.c,"wrook");
            }
            if(pos.white.rook2.active == 1){
                drawpiece(pos.white.rook2.r,pos.white.rook2.c,"wrook");
            }
        }
    </script>
    <style>
        
    </style>
    <head>
    
    </head>
    <body onload="start()" align="center" class="col">
        <canvas id="can">
            
        </canvas>
    </body>
</html>